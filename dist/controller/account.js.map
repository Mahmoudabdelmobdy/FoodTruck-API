{"version":3,"sources":["../../src/controller/account.js"],"names":["config","db","api","post","req","res","Account","register","username","body","email","password","err","account","send","passport","authenticate","session","status","scope","generateAccessToken","respond","get","logout","user"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;kBAEe,gBAAoB;AAAA,QAAjBA,MAAiB,QAAjBA,MAAiB;AAAA,QAATC,EAAS,QAATA,EAAS;;AAC/B,QAAIC,MAAM,sBAAV;;AAEA;AACAA,QAAIC,IAAJ,CAAS,WAAT,EAAsB,UAACC,GAAD,EAAMC,GAAN,EAAc;AAChCC,0BAAQC,QAAR,CAAiB,IAAID,iBAAJ,CAAY,EAACE,UAAUJ,IAAIK,IAAJ,CAASC,KAApB,EAAZ,CAAjB,EAAyDN,IAAIK,IAAJ,CAASE,QAAlE,EAA4E,UAASC,GAAT,EAAcC,OAAd,EAAuB;AAC/F,gBAAID,GAAJ,EAAS;AACLP,oBAAIS,IAAJ,CAASF,GAAT;AACH;;AAEDG,+BAASC,YAAT,CACI,OADJ,EACa;AACLC,yBAAS;AADJ,aADb,EAGOb,GAHP,EAGYC,GAHZ,EAGiB,YAAM;AACfA,oBAAIa,MAAJ,CAAW,GAAX,EAAgBJ,IAAhB,CAAqB,kCAArB;AACH,aALL;AAMH,SAXD;AAYH,KAbD;;AAeA;AACAZ,QAAIC,IAAJ,CAAS,QAAT,EAAmBY,mBAASC,YAAT,CACf,OADe,EACN;AACLC,iBAAS,KADJ;AAELE,eAAO;AAFF,KADM,CAAnB,EAIQC,mCAJR,EAI6BC,uBAJ7B;;AAMA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACAnB,QAAIoB,GAAJ,CAAQ,SAAR,EAAmBN,4BAAnB,EAAiC,UAACZ,GAAD,EAAMC,GAAN,EAAc;AAC3CA,YAAIkB,MAAJ;AACAlB,YAAIa,MAAJ,CAAW,GAAX,EAAgBJ,IAAhB,CAAqB,yBAArB;AACH,KAHD;;AAKA;AACAZ,QAAIoB,GAAJ,CAAQ,KAAR,EAAeN,4BAAf,EAA6B,UAACZ,GAAD,EAAMC,GAAN,EAAc;AACvCA,YAAIa,MAAJ,CAAW,GAAX,EAAgBJ,IAAhB,CAAqBV,IAAIoB,IAAzB;AACH,KAFD;;AAIA,WAAOtB,GAAP;AACH,C","file":"account.js","sourcesContent":["import mongoose from 'mongoose';\nimport { Router } from 'express';\nimport Account from '../model/account';\nimport bodyParser from 'body-parser';\nimport passport from 'passport';\nimport config from '../config';\n\nimport { generateAccessToken, respond, authenticate } from '../middleware/authMiddleware';\n\nexport default ({ config, db }) => {\n    let api = Router();\n\n    // '/v1/account/register'\n    api.post('/register', (req, res) => {\n        Account.register(new Account({username: req.body.email}),req.body.password, function(err ,account) {\n            if (err) {\n                res.send(err);\n            }\n\n            passport.authenticate(\n                'local', {\n                    session: false\n                })(req, res, () => {\n                    res.status(200).send('Successfully created new account');\n                });\n        });\n    });\n\n    // '/v1/account/login'\n    api.post('/login', passport.authenticate(\n        'local', {\n            session: false,\n            scope: []\n        }), generateAccessToken, respond);\n\n    // api.post('/login',(req, res) => {\n    //     passport.authenticate('local', function(err, user, info){\n    //        var token;\n            \n    //         // If Passport throws/catches an error\n    //         if (err) {\n    //           res.status(404).json(err);\n    //           return;\n    //         }\n            \n    //         // If a user is found\n    //         if(user){\n    //           token = user.generateJwt();\n    //           res.status(200);\n    //           res.json({\n    //             \"token\" : token\n    //           });\n    //         } else {\n    //           // If user is not found\n    //             res.status(401).json(info);\n    //         }\n    //       })(req, res);\n    // });\n\n    // '/v1/account/logout'\n    api.get('/logout', authenticate, (req, res) => {\n        res.logout();\n        res.status(200).send('Successfully logged out');\n    });\n\n    // '/v1/account/me'\n    api.get('/me', authenticate, (req, res) => {\n        res.status(200).send(req.user);\n    }); \n\n    return api;\n}"]}